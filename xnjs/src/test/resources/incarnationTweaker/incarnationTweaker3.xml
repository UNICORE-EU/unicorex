<?xml version="1.0" encoding="UTF-8"?>
<tns:incarnationTweaker xmlns:tns="http://eu.unicore/xnjs/incarnationTweaker"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<tns:beforeScript>
		<tns:rule>
			<tns:condition>app.applicationName == "HEAVY-APP" and (resources.individualPhysicalMemory == null or resources.individualPhysicalMemory &lt; 500000000)</tns:condition>
			<tns:action>resources.individualPhysicalMemory=500000000</tns:action>
		</tns:rule>
		<tns:rule>
			<tns:condition>app.executable == "/usr/bin/serial-app" and resources.individualCPUCount != null</tns:condition>
			<tns:action>resources.individualCPUCount=1</tns:action>
			<tns:action>resources.totalResourceCount=1</tns:action>
		</tns:rule>
		<tns:rule>
			<tns:condition>true</tns:condition>
			<tns:action type="script">/opt/addUserIfNotExists.sh ${client.xlogin.userName} ${client.xlogin.encodedGroups}</tns:action>
		</tns:rule>
	</tns:beforeScript>

	<tns:afterScript>
		<tns:rule>
			<tns:condition>true</tns:condition>
			<tns:action type="groovy">
int i=0;
input.eachLine() { line ->  
if(i==1) {
     println("#TSI_MYFLAG=SERIAL");
     println(line);
} else  
     println(line);

i++;
}
			</tns:action>
		</tns:rule>
	</tns:afterScript>
</tns:incarnationTweaker>
